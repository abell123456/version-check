var assert = require('assert');
var fs = require('fs');
var path = require('path');
var rmrf = require('rimraf');
var gitHooks = require('../src/git-hooks');

// Some very basic tests...

// should return git hooks path
gitHooks.hooksDir(function(err, dir) {
	assert.equal(err, null);
	assert.equal(dir, '.git/hooks');
});

// Reset tmp dir
rmrf.sync(path.join(__dirname, '../tmp'));
fs.mkdirSync(path.join(__dirname, '../tmp'));

var dir = path.join(__dirname, '../tmp/hooks');

// gitHooks should be able to create hooks directory and hook script
assert.doesNotThrow(function() {
	gitHooks.create(dir, 'pre-commit', 'foo');
});

// gitHooks should be able to update hook script
assert.doesNotThrow(function() {
	gitHooks.create(dir, 'pre-commit', 'bar');
});

assert(fs.readFileSync(dir + '/pre-commit', 'utf-8').indexOf('bar') !== -1);

// gitHooks should be able to remove a hook it has created
gitHooks.remove(dir, 'pre-commit');
assert(!fs.existsSync(dir + '/pre-commit'));

// gitHooks shouldn't be able to modify a user hook
fs.writeFileSync(dir + '/user-pre-commit', '');

gitHooks.create(dir, 'user-pre-commit', 'foo');
gitHooks.remove(dir, 'user-pre-commit');

assert.equal(fs.readFileSync(dir + '/user-pre-commit', 'utf-8'), '');
